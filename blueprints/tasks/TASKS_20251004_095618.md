# Task Breakdown: Todo Web Application
Generated: 2025-10-04T09:56:23Z
Context Usage: <5%

## Task Execution Order

### Task 1: Initialize Project Structure
- **Files**: package.json
- **Changes**:
  - Run `npm init -y` to create package.json
  - Install express and cors: `npm install express cors`
  - Add "start" script: `"node server.js"`
  - Set "type": "module" for ES6 imports
- **Tests**:
  - Verify package.json exists with correct dependencies
  - Verify node_modules directory created
- **Dependencies**: None
- **Estimated Context**: 5%

### Task 2: Create Storage Utility Module
- **Files**: utils/storage.js
- **Changes**:
  - Create utils directory
  - Implement `readTodos()` async function
    - Read data/todos.json using fs.promises.readFile
    - Parse JSON and return todos array
    - Handle ENOENT by initializing file with `{"todos":[]}`
    - Handle JSON parse errors by resetting to empty array
  - Implement `writeTodos(todos)` async function
    - Write to temporary file (todos.json.tmp)
    - Rename to todos.json (atomic operation)
    - Handle write errors with detailed logging
  - Export both functions
- **Tests**:
  - Manually test readTodos() creates file if missing
  - Manually test writeTodos() persists data
  - Test with corrupt JSON (should reset)
- **Dependencies**: Task 1
- **Estimated Context**: 15%

### Task 3: Create Express Server Foundation
- **Files**: server.js
- **Changes**:
  - Import express and cors
  - Create Express app instance
  - Configure cors middleware
  - Configure express.json() for body parsing
  - Configure express.static('public') for frontend files
  - Add basic error handling middleware
  - Listen on port 3000 (or process.env.PORT)
  - Log server start message
- **Tests**:
  - Run `node server.js` and verify starts without errors
  - Verify console shows "Server running on port 3000"
  - Test that static files would be served from /public
- **Dependencies**: Task 1
- **Estimated Context**: 10%

### Task 4: Implement GET /api/todos Endpoint
- **Files**: routes/todos.js, server.js
- **Changes**:
  - Create routes directory
  - Create routes/todos.js file
  - Import Router from express
  - Import storage functions from utils/storage.js
  - Implement GET / route handler:
    - Call readTodos()
    - Return JSON response with todos array
    - Wrap in try-catch, return 500 on error
  - Export router
  - In server.js, import and mount todos router at /api/todos
- **Tests**:
  - Start server
  - curl http://localhost:3000/api/todos
  - Verify returns `{"todos":[]}`
  - Add data to todos.json manually, verify returns data
- **Dependencies**: Task 2, Task 3
- **Estimated Context**: 15%

### Task 5: Implement POST /api/todos Endpoint
- **Files**: routes/todos.js
- **Changes**:
  - Implement POST / route handler:
    - Validate req.body.text exists and is non-empty string
    - Return 400 if validation fails
    - Call readTodos()
    - Generate new todo object:
      - id: crypto.randomUUID()
      - text: req.body.text
      - completed: false
      - createdAt: new Date().toISOString()
      - completedAt: null
    - Append to todos array
    - Call writeTodos(updatedTodos)
    - Return 201 with created todo
    - Wrap in try-catch, return 500 on error
- **Tests**:
  - curl -X POST http://localhost:3000/api/todos -H "Content-Type: application/json" -d '{"text":"Test todo"}'
  - Verify returns 201 with todo object
  - Verify todo appears in GET /api/todos
  - Test empty text returns 400
  - Verify todos.json file contains new todo
- **Dependencies**: Task 4
- **Estimated Context**: 20%

### Task 6: Implement PATCH /api/todos/:id/complete Endpoint
- **Files**: routes/todos.js
- **Changes**:
  - Implement PATCH /:id/complete route handler:
    - Extract id from req.params
    - Call readTodos()
    - Find todo by id using Array.find()
    - Return 404 if not found
    - Update todo:
      - completed: true
      - completedAt: new Date().toISOString()
    - Call writeTodos(updatedTodos)
    - Return 200 with updated todo
    - Wrap in try-catch, return 500 on error
- **Tests**:
  - Create todo via POST
  - curl -X PATCH http://localhost:3000/api/todos/{id}/complete
  - Verify returns 200 with completed=true
  - Verify completedAt timestamp exists
  - Test invalid ID returns 404
  - Verify todos.json shows completed status
- **Dependencies**: Task 5
- **Estimated Context**: 20%

### Task 7: Create Frontend HTML Structure
- **Files**: public/index.html
- **Changes**:
  - Create public directory
  - Create HTML5 boilerplate
  - Add head section:
    - charset, viewport meta tags
    - Title: "Todo App"
    - Link to style.css
  - Add body section:
    - Header with h1 "Todo App"
    - Form with:
      - Text input (id="todoInput", placeholder="Enter a new todo")
      - Submit button "Add Todo"
    - Empty div for todos list (id="todoList")
    - Empty div for error messages (id="errorMessage")
  - Link to app.js before closing body tag
- **Tests**:
  - Start server
  - Open http://localhost:3000 in browser
  - Verify page loads with form
  - Verify form elements are visible
- **Dependencies**: Task 3
- **Estimated Context**: 10%

### Task 8: Create Frontend Styling
- **Files**: public/style.css
- **Changes**:
  - Reset default margins/padding
  - Style body:
    - Font family: sans-serif
    - Max width 600px, centered
    - Padding for mobile
  - Style header/h1
  - Style form:
    - Flexbox layout
    - Input takes most space
    - Button fixed width
    - Spacing between elements
  - Style todo list:
    - List items with padding
    - Hover effect
  - Style complete button
  - Style completed todos:
    - Strikethrough text
    - Reduced opacity
    - Disabled button style
  - Style error message (red text)
- **Tests**:
  - Refresh browser
  - Verify clean, centered layout
  - Verify form is usable
  - Verify styling looks reasonable
- **Dependencies**: Task 7
- **Estimated Context**: 10%

### Task 9: Implement Frontend JavaScript - Load Todos
- **Files**: public/app.js
- **Changes**:
  - Create async loadTodos() function:
    - Fetch GET /api/todos
    - Parse JSON response
    - Call renderTodos(todos)
  - Create renderTodos(todos) function:
    - Clear todoList div
    - If empty, show "No todos yet"
    - For each todo:
      - Create list item div
      - Add todo text span
      - If not completed, add "Complete" button with onclick
      - Apply completed class if completed
      - Append to todoList
  - Add DOMContentLoaded event listener:
    - Call loadTodos()
  - Add error handling:
    - Create showError(message) function
    - Display in errorMessage div
    - Clear after 5 seconds
- **Tests**:
  - Add todos via curl
  - Refresh browser
  - Verify todos display
  - Verify completed todos show strikethrough
  - Verify "Complete" button missing on completed todos
- **Dependencies**: Task 8
- **Estimated Context**: 20%

### Task 10: Implement Frontend JavaScript - Add Todo
- **Files**: public/app.js
- **Changes**:
  - Get form element reference
  - Add submit event listener:
    - Prevent default form submission
    - Get input value, trim whitespace
    - Validate non-empty, show error if empty
    - Fetch POST /api/todos with text
    - On success:
      - Clear input field
      - Reload todos (call loadTodos())
    - On error:
      - Show error message with showError()
  - Handle network errors
  - Handle HTTP error responses (4xx, 5xx)
- **Tests**:
  - Open browser to http://localhost:3000
  - Type "Test todo" and submit
  - Verify todo appears in list
  - Submit empty form, verify error shows
  - Verify todos.json contains new todo
- **Dependencies**: Task 9
- **Estimated Context**: 15%

### Task 11: Implement Frontend JavaScript - Complete Todo
- **Files**: public/app.js
- **Changes**:
  - Create async completeTodo(id) function:
    - Fetch PATCH /api/todos/{id}/complete
    - On success:
      - Reload todos (call loadTodos())
    - On error:
      - Show error message
  - Modify renderTodos():
    - Set button onclick to call completeTodo(todo.id)
    - Disable button during API call (prevent double-click)
  - Add loading state feedback (optional)
- **Tests**:
  - Add todo via form
  - Click "Complete" button
  - Verify todo shows as completed (strikethrough)
  - Verify button disappears
  - Refresh page, verify state persists
  - Check todos.json shows completed=true
- **Dependencies**: Task 10
- **Estimated Context**: 15%

### Task 12: Add Data Directory Initialization
- **Files**: server.js, utils/storage.js
- **Changes**:
  - In storage.js, update readTodos():
    - Check if data directory exists using fs.access()
    - Create data directory if missing using fs.mkdir()
    - Then proceed with file read/create logic
  - Ensure atomic initialization (avoid race conditions)
- **Tests**:
  - Delete data directory
  - Start server
  - Make API request
  - Verify data directory and todos.json created
- **Dependencies**: Task 2
- **Estimated Context**: 10%

### Task 13: Comprehensive Error Handling & Edge Cases
- **Files**: routes/todos.js, public/app.js
- **Changes**:
  - Backend:
    - Add input sanitization (trim whitespace)
    - Add max length validation (1000 chars)
    - Improve error messages (specific validation failures)
    - Add request logging (method, path, status)
  - Frontend:
    - Add loading spinner during API calls
    - Disable form during submission
    - Add empty state message with icon
    - Improve error message styling
    - Add success feedback for operations
- **Tests**:
  - Test with very long todo text (>1000 chars)
  - Test with special characters in text
  - Test with malformed JSON in todos.json
  - Test with no network connection (disconnect)
  - Test rapid button clicking
  - Test file permissions (read-only data directory)
- **Dependencies**: Task 11, Task 12
- **Estimated Context**: 20%

### Task 14: Final Integration Testing & Validation
- **Files**: All files (read-only verification)
- **Changes**: No code changes, testing only
- **Tests**:
  - Complete end-to-end workflow:
    1. Start fresh (delete todos.json)
    2. Start server
    3. Open browser
    4. Add 5 todos
    5. Complete 3 todos
    6. Refresh page - verify state persists
    7. Restart server - verify state persists
    8. Check todos.json format is correct
  - Verify all success criteria from SPEC.md
  - Verify error handling for all edge cases
  - Performance test: Add 100 todos, verify responsive
  - Cross-browser test (Chrome, Firefox, Safari)
- **Dependencies**: Task 13
- **Estimated Context**: 10%

## Summary
- **Total Tasks**: 14
- **Total Estimated Context**: ~195%
- **Critical Path**: Tasks 1→2→3→4→5→6 (Backend), then 7→8→9→10→11 (Frontend)
- **Parallel Opportunities**:
  - Tasks 3 and 7 can start after Task 1
  - Tasks 8-11 depend on each other sequentially
- **Checkpoints**:
  - After Task 6: Backend fully functional (test with curl)
  - After Task 11: Full application functional
  - After Task 14: Production ready

## File Creation Summary
Files to create (8 files):
1. package.json (Task 1)
2. utils/storage.js (Task 2)
3. server.js (Task 3)
4. routes/todos.js (Task 4)
5. public/index.html (Task 7)
6. public/style.css (Task 8)
7. public/app.js (Task 9)
8. data/todos.json (auto-created by storage.js)

Estimated total lines of code: ~300 lines
```