# Research Report: Web-Based Todo App

Generated: 2025-10-04 09:20:57 UTC
Context Usage: ~15%

## Architecture Overview

A lightweight web-based todo application with JSON file storage. This is a client-server architecture with:
- **Backend**: RESTful API server handling business logic and file I/O
- **Frontend**: Single-page application (SPA) with dynamic UI
- **Storage**: Local JSON file acting as a simple database
- **No authentication** required for MVP (single-user local application)

## Technology Stack Recommendations

### Backend Options
1. **Python + Flask/FastAPI** (Recommended for simplicity)
   - FastAPI: Modern, async, auto-generated API docs
   - Flask: Lightweight, well-documented, perfect for simple APIs
   - Built-in JSON handling

2. **Node.js + Express** (Alternative)
   - Native JSON support
   - Single language across stack

### Frontend
- **Vanilla HTML/CSS/JavaScript** (Recommended for simplicity)
  - No build step required
  - Fast development
  - Minimal dependencies
  
- **React/Vue** (If more complex features planned)

### Recommendation: **FastAPI + Vanilla JS**
- FastAPI provides auto-docs, type safety, and modern async patterns
- Vanilla JS keeps frontend simple and dependency-free

## Project Structure

```
todo-cli/
├── backend/
│   ├── main.py              # FastAPI server entry point
│   ├── models.py            # Data models (Pydantic)
│   ├── storage.py           # JSON file operations
│   └── requirements.txt     # Python dependencies
├── frontend/
│   ├── index.html           # Main UI
│   ├── styles.css           # Styling
│   └── app.js               # Frontend logic
├── data/
│   └── todos.json           # Storage file
└── README.md               # Setup instructions
```

## Data Models

### Todo Item Schema
```json
{
  "id": "uuid-string",
  "title": "string",
  "description": "string (optional)",
  "completed": false,
  "created_at": "ISO-8601 timestamp",
  "completed_at": "ISO-8601 timestamp (nullable)"
}
```

### Storage File Structure
```json
{
  "todos": [
    { "id": "...", "title": "...", ... }
  ],
  "metadata": {
    "version": "1.0",
    "last_modified": "timestamp"
  }
}
```

## API Endpoints

### RESTful Design
- `POST /api/todos` - Add new todo
- `GET /api/todos` - List all todos (with optional ?completed=true/false filter)
- `PATCH /api/todos/{id}/complete` - Mark as complete
- `DELETE /api/todos/{id}` - Delete todo (optional enhancement)
- `GET /` - Serve frontend HTML

## Component Details

### Backend Components

#### 1. Storage Layer (`storage.py`)
**Purpose**: Abstract JSON file operations
**Key Functions**:
- `load_todos()` - Read from JSON with file locking
- `save_todos()` - Write to JSON atomically
- `ensure_data_file()` - Initialize if missing

**Challenges**:
- File locking for concurrent access
- Atomic writes to prevent corruption
- Handle malformed JSON gracefully

#### 2. Data Models (`models.py`)
**Purpose**: Type-safe data structures using Pydantic
```python
from pydantic import BaseModel
from datetime import datetime
from uuid import UUID

class TodoCreate(BaseModel):
    title: str
    description: str | None = None

class Todo(BaseModel):
    id: UUID
    title: str
    description: str | None
    completed: bool = False
    created_at: datetime
    completed_at: datetime | None = None
```

#### 3. API Server (`main.py`)
**Purpose**: HTTP endpoints and business logic
**Dependencies**: FastAPI, Uvicorn, Pydantic
**Key Patterns**:
- Dependency injection for storage access
- Exception handlers for 404/500
- CORS middleware for browser access

### Frontend Components

#### 1. UI (`index.html`)
**Structure**:
- Input form for new todos
- List container for todo items
- Filter buttons (All/Active/Completed)

#### 2. State Management (`app.js`)
**Pattern**: Simple client-side state + API sync
```javascript
class TodoApp {
  constructor() {
    this.todos = [];
    this.filter = 'all'; // all | active | completed
  }
  
  async fetchTodos() { /* GET /api/todos */ }
  async addTodo(title) { /* POST /api/todos */ }
  async completeTodo(id) { /* PATCH /api/todos/{id}/complete */ }
  render() { /* Update DOM */ }
}
```

## Data Flow

1. **Add Todo**:
   - User submits form → POST /api/todos
   - Backend generates UUID, timestamps
   - Append to JSON file
   - Return created todo → Update UI

2. **List Todos**:
   - Page load → GET /api/todos
   - Backend reads JSON file
   - Return array → Render in UI

3. **Complete Todo**:
   - User clicks checkbox → PATCH /api/todos/{id}/complete
   - Backend updates completed flag + timestamp
   - Save to JSON → Update UI

## Patterns & Conventions

- **Atomic File Writes**: Write to temp file, then rename (prevents corruption)
- **File Locking**: Use `fcntl` (Unix) or `msvcrt` (Windows) for concurrent safety
- **Error Handling**: Try-catch on all file operations with fallback
- **UUID v4**: For unique, collision-resistant IDs
- **ISO 8601**: Standard datetime format for cross-platform compatibility
- **RESTful URLs**: Resource-based endpoints with HTTP verb semantics

## Integration Points

### Storage
- **JSON Module**: Built-in Python `json` library
- **File System**: Standard `pathlib` for cross-platform paths
- **Locking**: `filelock` library (pip installable) for safe concurrent access

### Server
- **ASGI Server**: Uvicorn to run FastAPI
- **Static Files**: FastAPI's `StaticFiles` to serve frontend
- **CORS**: Required for local development (if served on different ports)

## Potential Challenges

1. **Concurrent Access**
   - Multiple requests modifying JSON simultaneously
   - **Solution**: File locking library (`filelock`)

2. **File Corruption**
   - Partial writes if process crashes
   - **Solution**: Atomic writes (write to `.tmp`, then `os.replace`)

3. **JSON File Growth**
   - Performance degrades with thousands of todos
   - **Solution**: Implement soft delete or archiving (future)

4. **Frontend State Sync**
   - UI and server getting out of sync
   - **Solution**: Re-fetch after mutations, optimistic updates

5. **Error Recovery**
   - Malformed JSON from manual editing
   - **Solution**: Backup on load, provide repair tool

6. **Cross-Platform Paths**
   - Windows vs Unix path separators
   - **Solution**: Use `pathlib.Path` exclusively

## Recommendations

### Implementation Order
1. **Backend First**: Establish API contract
   - Setup FastAPI project
   - Implement storage layer with tests
   - Create API endpoints
   - Test with curl/Postman

2. **Frontend Second**: Build against working API
   - Create static HTML structure
   - Implement API client functions
   - Add interactivity
   - Style with CSS

3. **Integration**: Connect and refine
   - Serve frontend from backend
   - Handle edge cases
   - Add error messages

### Quick Start Dependencies
```txt
# requirements.txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
pydantic==2.5.0
filelock==3.13.1
```

### Development Workflow
```bash
# Start server
uvicorn backend.main:app --reload --port 8000

# Access app
open http://localhost:8000
```

### Testing Strategy
- **Unit Tests**: Storage layer functions
- **Integration Tests**: API endpoints with test JSON file
- **Manual Testing**: Browser interaction

### Future Enhancements (Out of Scope)
- Edit todo text
- Due dates
- Categories/tags
- Multi-user with SQLite
- Undo/redo
- Keyboard shortcuts

## Success Criteria
- ✅ Add todo with title
- ✅ List all todos
- ✅ Mark todo as complete
- ✅ Data persists across server restarts
- ✅ Clean, responsive UI
- ✅ No data loss or corruption