<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temperature Color Coding Tests - Weather Web</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .test-results { font-family: Arial, sans-serif; margin: 20px; }
        .test-pass { color: green; }
        .test-fail { color: red; }
        .test-section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .test-info { color: blue; margin: 5px 0; }
        .color-demo { 
            display: inline-block; 
            width: 60px; 
            height: 30px; 
            margin: 5px; 
            border: 1px solid #000;
            text-align: center;
            line-height: 30px;
            font-size: 12px;
            color: white;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
        }
        .temperature-examples {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .temp-example {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            min-width: 100px;
            color: white;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.7);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-results">
        <h1>Temperature Color Coding System Tests</h1>
        <div id="test-output"></div>
        
        <div class="test-section">
            <h2>Visual Color Examples</h2>
            <div class="temperature-examples">
                <div id="temp-demo-freezing" class="temp-example">-10°C<br>Freezing</div>
                <div id="temp-demo-cold" class="temp-example">5°C<br>Cold</div>
                <div id="temp-demo-cool" class="temp-example">15°C<br>Cool</div>
                <div id="temp-demo-mild" class="temp-example">20°C<br>Mild</div>
                <div id="temp-demo-warm" class="temp-example">25°C<br>Warm</div>
                <div id="temp-demo-hot" class="temp-example">35°C<br>Hot</div>
                <div id="temp-demo-scorching" class="temp-example">45°C<br>Scorching</div>
            </div>
        </div>

        <div class="test-section">
            <h2>Dynamic Theme Examples</h2>
            <div id="theme-demo">
                <button id="test-sunny-theme" class="btn btn--primary">Sunny Theme</button>
                <button id="test-rainy-theme" class="btn btn--primary">Rainy Theme</button>
                <button id="test-snowy-theme" class="btn btn--primary">Snowy Theme</button>
                <button id="test-stormy-theme" class="btn btn--primary">Stormy Theme</button>
                <button id="reset-theme" class="btn btn--secondary">Reset Theme</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Test framework
        class TestRunner {
            constructor() {
                this.tests = [];
                this.output = document.getElementById('test-output');
            }

            test(name, fn) {
                this.tests.push({ name, fn });
            }

            async run() {
                let passed = 0;
                let failed = 0;

                for (const test of this.tests) {
                    try {
                        await test.fn();
                        this.log(`✓ ${test.name}`, 'test-pass');
                        passed++;
                    } catch (error) {
                        this.log(`✗ ${test.name}: ${error.message}`, 'test-fail');
                        console.error('Test error:', error);
                        failed++;
                    }
                }

                this.log(`\nResults: ${passed} passed, ${failed} failed`, 
                         failed === 0 ? 'test-pass' : 'test-fail');
            }

            log(message, className = '') {
                const div = document.createElement('div');
                div.textContent = message;
                div.className = className;
                this.output.appendChild(div);
            }

            assert(condition, message) {
                if (!condition) {
                    throw new Error(message);
                }
            }

            assertEqual(actual, expected, message) {
                if (actual !== expected) {
                    throw new Error(`${message}: expected ${expected}, got ${actual}`);
                }
            }

            assertNotEqual(actual, notExpected, message) {
                if (actual === notExpected) {
                    throw new Error(`${message}: expected not ${notExpected}, got ${actual}`);
                }
            }

            assertContains(str, substring, message) {
                if (!str.includes(substring)) {
                    throw new Error(`${message}: "${str}" does not contain "${substring}"`);
                }
            }
        }

        const runner = new TestRunner();

        // Helper function to get computed CSS custom property value
        function getCSSCustomProperty(property) {
            return getComputedStyle(document.documentElement)
                .getPropertyValue(property)
                .trim();
        }

        // Helper function to convert RGB to hex
        function rgbToHex(rgb) {
            if (!rgb) return null;
            const match = rgb.match(/\d+/g);
            if (!match) return null;
            return '#' + match.map(x => parseInt(x).toString(16).padStart(2, '0')).join('');
        }

        // CSS Custom Properties Tests
        runner.test('Temperature color CSS custom properties are defined', () => {
            const tempColors = [
                '--temp-freezing',
                '--temp-cold', 
                '--temp-cool',
                '--temp-mild',
                '--temp-warm',
                '--temp-hot',
                '--temp-scorching'
            ];

            tempColors.forEach(property => {
                const value = getCSSCustomProperty(property);
                runner.assert(value && value !== '', `${property} should be defined with a value`);
            });
        });

        runner.test('Weather condition color properties are defined', () => {
            const weatherColors = [
                '--weather-sunny',
                '--weather-cloudy',
                '--weather-rainy',
                '--weather-snowy',
                '--weather-stormy',
                '--weather-foggy'
            ];

            weatherColors.forEach(property => {
                const value = getCSSCustomProperty(property);
                runner.assert(value && value !== '', `${property} should be defined with a value`);
            });
        });

        runner.test('Temperature gradient properties are defined', () => {
            const gradientProperties = [
                '--temp-gradient-cold',
                '--temp-gradient-warm',
                '--temp-gradient-hot'
            ];

            gradientProperties.forEach(property => {
                const value = getCSSCustomProperty(property);
                runner.assert(value && value !== '', `${property} should be defined with a gradient value`);
                runner.assertContains(value.toLowerCase(), 'linear-gradient', 'Should be a linear gradient');
            });
        });

        runner.test('Theme variation properties exist', () => {
            const themeProperties = [
                '--theme-primary',
                '--theme-secondary',
                '--theme-background',
                '--theme-surface',
                '--theme-accent'
            ];

            themeProperties.forEach(property => {
                const value = getCSSCustomProperty(property);
                runner.assert(value && value !== '', `${property} should be defined`);
            });
        });

        // JavaScript Helper Function Tests
        runner.test('Temperature color helper functions are available', async () => {
            const helpers = await import('../js/utils/helpers.js');
            
            runner.assert(typeof helpers.getTemperatureColor === 'function', 'getTemperatureColor should be a function');
            runner.assert(typeof helpers.getTemperatureClass === 'function', 'getTemperatureClass should be a function');
            runner.assert(typeof helpers.applyTemperatureColor === 'function', 'applyTemperatureColor should be a function');
            runner.assert(typeof helpers.getWeatherThemeColors === 'function', 'getWeatherThemeColors should be a function');
            runner.assert(typeof helpers.applyWeatherTheme === 'function', 'applyWeatherTheme should be a function');
            runner.assert(typeof helpers.resetTheme === 'function', 'resetTheme should be a function');
        });

        runner.test('Temperature color classification works correctly', async () => {
            const { getTemperatureClass, getTemperatureColor } = await import('../js/utils/helpers.js');
            
            // Test temperature classifications
            runner.assertEqual(getTemperatureClass(-15), 'freezing', 'Below -10°C should be freezing');
            runner.assertEqual(getTemperatureClass(-5), 'freezing', '-5°C should be freezing');
            runner.assertEqual(getTemperatureClass(2), 'cold', '2°C should be cold');
            runner.assertEqual(getTemperatureClass(8), 'cold', '8°C should be cold');
            runner.assertEqual(getTemperatureClass(12), 'cool', '12°C should be cool');
            runner.assertEqual(getTemperatureClass(18), 'mild', '18°C should be mild');
            runner.assertEqual(getTemperatureClass(24), 'warm', '24°C should be warm');
            runner.assertEqual(getTemperatureClass(32), 'hot', '32°C should be hot');
            runner.assertEqual(getTemperatureClass(42), 'scorching', '42°C should be scorching');
            
            // Test color retrieval
            runner.assertNotEqual(getTemperatureColor(-5), getTemperatureColor(25), 'Different temperatures should have different colors');
            runner.assert(getTemperatureColor(20).startsWith('#') || getTemperatureColor(20).startsWith('rgb'), 'Should return a valid color value');
        });

        runner.test('Temperature color application works on DOM elements', async () => {
            const { applyTemperatureColor } = await import('../js/utils/helpers.js');
            
            const testElement = document.createElement('div');
            testElement.textContent = '25°C';
            document.body.appendChild(testElement);
            
            applyTemperatureColor(testElement, 25);
            
            const styles = getComputedStyle(testElement);
            runner.assert(styles.color && styles.color !== 'rgb(0, 0, 0)', 'Element should have temperature color applied');
            
            document.body.removeChild(testElement);
        });

        runner.test('Weather theme application changes CSS custom properties', async () => {
            const { applyWeatherTheme, resetTheme } = await import('../js/utils/helpers.js');
            
            // Store original values
            const originalPrimary = getCSSCustomProperty('--theme-primary');
            
            // Apply sunny theme
            applyWeatherTheme('sunny');
            const sunnyPrimary = getCSSCustomProperty('--theme-primary');
            
            runner.assertNotEqual(sunnyPrimary, originalPrimary, 'Theme should change primary color');
            
            // Apply rainy theme  
            applyWeatherTheme('rainy');
            const rainyPrimary = getCSSCustomProperty('--theme-primary');
            
            runner.assertNotEqual(rainyPrimary, sunnyPrimary, 'Different themes should have different colors');
            
            // Reset theme
            resetTheme();
            const resetPrimary = getCSSCustomProperty('--theme-primary');
            
            runner.assertEqual(resetPrimary, originalPrimary, 'Reset should restore original colors');
        });

        runner.test('Invalid inputs are handled gracefully', async () => {
            const { getTemperatureClass, getTemperatureColor, applyTemperatureColor } = await import('../js/utils/helpers.js');
            
            // Test invalid temperature values
            runner.assertEqual(getTemperatureClass(NaN), 'mild', 'NaN should default to mild');
            runner.assertEqual(getTemperatureClass(null), 'mild', 'null should default to mild');
            runner.assertEqual(getTemperatureClass(undefined), 'mild', 'undefined should default to mild');
            runner.assertEqual(getTemperatureClass('not-a-number'), 'mild', 'string should default to mild');
            
            // Test extreme values
            runner.assertEqual(getTemperatureClass(-100), 'freezing', 'Extreme cold should be freezing');
            runner.assertEqual(getTemperatureClass(100), 'scorching', 'Extreme heat should be scorching');
            
            // Test color retrieval with invalid values
            const defaultColor = getTemperatureColor(20); // Valid baseline
            runner.assertEqual(getTemperatureColor(NaN), defaultColor, 'Invalid temperature should return default color');
        });

        runner.test('CSS classes are properly applied and removed', async () => {
            const { applyTemperatureColor } = await import('../js/utils/helpers.js');
            
            const testElement = document.createElement('div');
            document.body.appendChild(testElement);
            
            // Apply cold temperature
            applyTemperatureColor(testElement, 5);
            runner.assert(testElement.className.includes('temperature--cold'), 'Should apply cold temperature class');
            
            // Apply hot temperature
            applyTemperatureColor(testElement, 35);
            runner.assert(testElement.className.includes('temperature--hot'), 'Should apply hot temperature class');
            runner.assert(!testElement.className.includes('temperature--cold'), 'Should remove previous temperature class');
            
            document.body.removeChild(testElement);
        });

        runner.test('Gradient backgrounds are applied correctly', async () => {
            const { applyTemperatureGradient } = await import('../js/utils/helpers.js');
            
            if (typeof applyTemperatureGradient === 'function') {
                const testElement = document.createElement('div');
                testElement.style.width = '100px';
                testElement.style.height = '50px';
                document.body.appendChild(testElement);
                
                applyTemperatureGradient(testElement, 25, 30);
                
                const styles = getComputedStyle(testElement);
                runner.assertContains(styles.background.toLowerCase(), 'gradient', 'Should apply gradient background');
                
                document.body.removeChild(testElement);
            }
        });

        runner.test('High contrast mode support works', async () => {
            const { getTemperatureColor } = await import('../js/utils/helpers.js');
            
            // Simulate high contrast preference
            const originalMatchMedia = window.matchMedia;
            window.matchMedia = (query) => ({
                matches: query.includes('prefers-contrast: high'),
                addListener: () => {},
                removeListener: () => {}
            });
            
            try {
                const color = getTemperatureColor(25, { highContrast: true });
                runner.assert(color !== null, 'Should return a color in high contrast mode');
            } finally {
                window.matchMedia = originalMatchMedia;
            }
        });

        // Visual demonstration setup
        function setupVisualDemos() {
            // Set up temperature examples with actual colors
            import('../js/utils/helpers.js').then(helpers => {
                const temperatures = [
                    { element: 'temp-demo-freezing', temp: -10 },
                    { element: 'temp-demo-cold', temp: 5 },
                    { element: 'temp-demo-cool', temp: 15 },
                    { element: 'temp-demo-mild', temp: 20 },
                    { element: 'temp-demo-warm', temp: 25 },
                    { element: 'temp-demo-hot', temp: 35 },
                    { element: 'temp-demo-scorching', temp: 45 }
                ];
                
                temperatures.forEach(({ element, temp }) => {
                    const el = document.getElementById(element);
                    if (el) {
                        helpers.applyTemperatureColor(el, temp);
                    }
                });
                
                // Set up theme demo buttons
                const themeButtons = [
                    { id: 'test-sunny-theme', theme: 'sunny' },
                    { id: 'test-rainy-theme', theme: 'rainy' },
                    { id: 'test-snowy-theme', theme: 'snowy' },
                    { id: 'test-stormy-theme', theme: 'stormy' }
                ];
                
                themeButtons.forEach(({ id, theme }) => {
                    const button = document.getElementById(id);
                    if (button) {
                        button.addEventListener('click', () => {
                            helpers.applyWeatherTheme(theme);
                        });
                    }
                });
                
                const resetButton = document.getElementById('reset-theme');
                if (resetButton) {
                    resetButton.addEventListener('click', () => {
                        helpers.resetTheme();
                    });
                }
            });
        }

        // Run tests and setup demos
        runner.run().then(() => {
            setupVisualDemos();
        });
    </script>
</body>
</html>