# Session Summary Schema

This document describes the structure of `.context-foundry/session-summary.json` generated by autonomous builds.

## Schema Version: 2.1

Updated: 2025-10-24 (Added GitHub metadata and prompt versioning)

## Complete Schema

```json
{
  "session_id": "string",
  "task_description": "string",
  "mode": "new_project | fix_bug | add_feature | refactor | upgrade_deps | add_tests",
  "status": "completed | tests_failed_max_iterations | failed",
  "working_directory": "string (absolute path)",
  "started_at": "ISO 8601 timestamp",
  "completed_at": "ISO 8601 timestamp",
  "duration_minutes": "number",

  "phases_completed": [
    "Scout",
    "Architect",
    "Builder",
    "Test",
    "Screenshot",
    "Documentation",
    "Deploy",
    "Feedback",
    "GitHub"
  ],

  "prompt_metadata": {
    "orchestrator_version": "string (e.g., v1.0.0)",
    "orchestrator_tokens": "number (estimated token count)",
    "orchestrator_file": "string (filename of prompt version used)",
    "github_agent_version": "string (e.g., v1.0.0)",
    "github_agent_tokens": "number (estimated token count)"
  },

  "codebase_detection": {
    "has_existing_code": "boolean",
    "project_type": "string (python, nodejs, rust, etc.)",
    "languages": ["string"],
    "confidence": "high | medium | low",
    "has_git": "boolean",
    "git_clean": "boolean | null"
  },

  "test_results": {
    "tests_passed": "boolean",
    "test_iterations": "number",
    "test_failures": ["string"],
    "final_iteration": "number",
    "test_command": "string"
  },

  "files": {
    "files_created": ["string (relative paths)"],
    "files_modified": ["string (relative paths)"],
    "total_files": "number"
  },

  "git": {
    "initial_commit_sha": "string",
    "final_commit_sha": "string",
    "branch": "string",
    "remote_url": "string | null"
  },

  "screenshots": {
    "screenshots_captured": "number",
    "hero_screenshot": "string (path) | null",
    "manifest_path": "string (path) | null",
    "screenshot_types": ["hero", "feature", "step"]
  },

  "feedback": {
    "analyzed": "boolean",
    "feedback_file": "string (path)",
    "patterns_merged_to_global": "boolean",
    "global_patterns_updated": ["string (paths)"],
    "new_patterns_added_globally": "number",
    "existing_patterns_updated_globally": "number",
    "pattern_merge_status": "success | failed",
    "pattern_merge_error": "string | null",
    "high_priority_recommendations": "number",
    "cross_project_learning_enabled": "boolean"
  },

  "github": {
    "issue_number": "number | null",
    "issue_url": "string | null",
    "issue_status": "open | closed",
    "pr_number": "number | null",
    "pr_url": "string | null",
    "pr_status": "draft | open | merged | closed",
    "release_version": "string | null",
    "release_url": "string | null",
    "pages_url": "string | null",
    "pages_status": "live | deploying | failed | null",
    "workflows_created": "boolean",
    "workflow_files": ["string (paths)"],
    "actions_url": "string",
    "branch_protection_enabled": "boolean",
    "labels_created": ["string"],
    "templates_created": ["string (paths)"]
  },

  "artifacts_location": "string (path to .context-foundry/)",
  "issues_encountered": ["string"],
  "success_summary": "string"
}
```

## Field Descriptions

### Top-Level Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `session_id` | string | Yes | Unique identifier for this build session (usually project directory name) |
| `task_description` | string | Yes | Original task description from user |
| `mode` | string (enum) | Yes | Build mode: `new_project`, `fix_bug`, `add_feature`, `refactor`, `upgrade_deps`, `add_tests` |
| `status` | string (enum) | Yes | Final status: `completed`, `tests_failed_max_iterations`, `failed` |
| `working_directory` | string | Yes | Absolute path to project directory |
| `started_at` | string | Yes | ISO 8601 timestamp when build started |
| `completed_at` | string | Yes | ISO 8601 timestamp when build completed |
| `duration_minutes` | number | Yes | Total build duration in minutes |
| `phases_completed` | array[string] | Yes | List of phases completed successfully |

### `prompt_metadata` Object (NEW in v2.1)

Tracks which prompt versions were used for this build, enabling performance comparison across prompt versions.

| Field | Type | Description |
|-------|------|-------------|
| `orchestrator_version` | string | Version of orchestrator prompt (e.g., `v1.0.0`, `v1.1.0`) |
| `orchestrator_tokens` | number | Estimated token count of orchestrator prompt |
| `orchestrator_file` | string | Filename of archived prompt version used |
| `github_agent_version` | string | Version of GitHub agent prompt |
| `github_agent_tokens` | number | Estimated token count of GitHub agent prompt |

**Purpose:** Track prompt performance over time. Compare metrics (success rate, test iterations, duration) across different prompt versions to identify optimization improvements.

### `codebase_detection` Object

Only populated for enhancement modes (not `new_project`).

| Field | Type | Description |
|-------|------|-------------|
| `has_existing_code` | boolean | Whether existing code was detected |
| `project_type` | string | Detected project type (python, nodejs, rust, etc.) |
| `languages` | array[string] | List of programming languages found |
| `confidence` | string | Detection confidence: `high`, `medium`, `low` |
| `has_git` | boolean | Whether git repository exists |
| `git_clean` | boolean/null | Whether working tree is clean (null if no git) |

### `test_results` Object

| Field | Type | Description |
|-------|------|-------------|
| `tests_passed` | boolean | Whether all tests passed |
| `test_iterations` | number | Number of test-fix iterations |
| `test_failures` | array[string] | List of test failure messages (empty if passed) |
| `final_iteration` | number | Final iteration number |
| `test_command` | string | Command used to run tests |

### `files` Object

| Field | Type | Description |
|-------|------|-------------|
| `files_created` | array[string] | Paths of files created during build |
| `files_modified` | array[string] | Paths of files modified during build |
| `total_files` | number | Total number of files in project after build |

### `git` Object

| Field | Type | Description |
|-------|------|-------------|
| `initial_commit_sha` | string | SHA of first commit in this build |
| `final_commit_sha` | string | SHA of final commit |
| `branch` | string | Git branch used |
| `remote_url` | string/null | Remote repository URL (null if not pushed) |

### `screenshots` Object

Only populated if screenshot capture was successful.

| Field | Type | Description |
|-------|------|-------------|
| `screenshots_captured` | number | Total number of screenshots captured |
| `hero_screenshot` | string/null | Path to main hero screenshot |
| `manifest_path` | string/null | Path to screenshot manifest JSON |
| `screenshot_types` | array[string] | Types of screenshots captured: `hero`, `feature`, `step` |

### `feedback` Object

Populated after Phase 7 (Feedback Analysis).

| Field | Type | Description |
|-------|------|-------------|
| `analyzed` | boolean | Whether feedback analysis completed |
| `feedback_file` | string | Path to feedback analysis file |
| `patterns_merged_to_global` | boolean | Whether patterns were merged to global storage |
| `global_patterns_updated` | array[string] | Paths of global pattern files updated |
| `new_patterns_added_globally` | number | Number of new patterns added to global storage |
| `existing_patterns_updated_globally` | number | Number of existing patterns updated in global storage |
| `pattern_merge_status` | string | Status of pattern merge: `success`, `failed` |
| `pattern_merge_error` | string/null | Error message if merge failed (null if success) |
| `high_priority_recommendations` | number | Number of high-priority recommendations |
| `cross_project_learning_enabled` | boolean | Whether cross-project learning is active |

### `github` Object (NEW in v2.0)

Populated after Phase 7.5 (GitHub Integration).

| Field | Type | Description |
|-------|------|-------------|
| `issue_number` | number/null | GitHub issue number created for tracking |
| `issue_url` | string/null | Full URL to GitHub issue |
| `issue_status` | string | Status of issue: `open`, `closed` |
| `pr_number` | number/null | Pull request number (for enhancement mode) |
| `pr_url` | string/null | Full URL to pull request |
| `pr_status` | string | PR status: `draft`, `open`, `merged`, `closed` |
| `release_version` | string/null | Version number of GitHub release created |
| `release_url` | string/null | Full URL to GitHub release |
| `pages_url` | string/null | GitHub Pages URL (for web apps) |
| `pages_status` | string/null | Pages deployment status: `live`, `deploying`, `failed`, null |
| `workflows_created` | boolean | Whether GitHub Actions workflows were created |
| `workflow_files` | array[string] | Paths of workflow files created |
| `actions_url` | string | URL to GitHub Actions page |
| `branch_protection_enabled` | boolean | Whether branch protection was enabled |
| `labels_created` | array[string] | List of GitHub labels created |
| `templates_created` | array[string] | Paths of issue/PR templates created |

## Examples

### Example 1: Successful New Project

```json
{
  "session_id": "weather-app",
  "task_description": "Build a weather app with OpenWeatherMap API",
  "mode": "new_project",
  "status": "completed",
  "working_directory": "/Users/name/homelab/weather-app",
  "started_at": "2025-10-24T10:00:00Z",
  "completed_at": "2025-10-24T10:45:30Z",
  "duration_minutes": 45.5,
  "phases_completed": [
    "Scout",
    "Architect",
    "Builder",
    "Test",
    "Screenshot",
    "Documentation",
    "Deploy",
    "Feedback",
    "GitHub"
  ],
  "prompt_metadata": {
    "orchestrator_version": "v1.0.0",
    "orchestrator_tokens": 12500,
    "orchestrator_file": "orchestrator_prompt_v1.0.0_baseline.txt",
    "github_agent_version": "v1.0.0",
    "github_agent_tokens": 2800
  },
  "codebase_detection": null,
  "test_results": {
    "tests_passed": true,
    "test_iterations": 1,
    "test_failures": [],
    "final_iteration": 1,
    "test_command": "npm test"
  },
  "files": {
    "files_created": [
      "src/App.jsx",
      "src/components/WeatherCard.jsx",
      "src/api/weather.js",
      "tests/App.test.jsx",
      "package.json",
      "README.md"
    ],
    "files_modified": [],
    "total_files": 23
  },
  "git": {
    "initial_commit_sha": "abc123def456",
    "final_commit_sha": "xyz789abc123",
    "branch": "main",
    "remote_url": "https://github.com/snedea/weather-app.git"
  },
  "screenshots": {
    "screenshots_captured": 5,
    "hero_screenshot": "docs/screenshots/hero.png",
    "manifest_path": "docs/screenshots/manifest.json",
    "screenshot_types": ["hero", "feature", "step"]
  },
  "feedback": {
    "analyzed": true,
    "feedback_file": ".context-foundry/feedback/build-feedback-2025-10-24.json",
    "patterns_merged_to_global": true,
    "global_patterns_updated": [
      "~/.context-foundry/patterns/common-issues.json"
    ],
    "new_patterns_added_globally": 1,
    "existing_patterns_updated_globally": 2,
    "pattern_merge_status": "success",
    "pattern_merge_error": null,
    "high_priority_recommendations": 0,
    "cross_project_learning_enabled": true
  },
  "github": {
    "issue_number": 1,
    "issue_url": "https://github.com/snedea/weather-app/issues/1",
    "issue_status": "closed",
    "pr_number": null,
    "pr_url": null,
    "pr_status": null,
    "release_version": "1.0.0",
    "release_url": "https://github.com/snedea/weather-app/releases/tag/v1.0.0",
    "pages_url": "https://snedea.github.io/weather-app",
    "pages_status": "live",
    "workflows_created": true,
    "workflow_files": [
      ".github/workflows/test.yml",
      ".github/workflows/deploy.yml"
    ],
    "actions_url": "https://github.com/snedea/weather-app/actions",
    "branch_protection_enabled": true,
    "labels_created": [
      "context-foundry",
      "autonomous-build"
    ],
    "templates_created": [
      ".github/ISSUE_TEMPLATE/bug_report.md",
      ".github/ISSUE_TEMPLATE/feature_request.md"
    ]
  },
  "artifacts_location": ".context-foundry/",
  "issues_encountered": [],
  "success_summary": "Successfully built weather app. All tests passing. 5 screenshots captured. Deployed to GitHub with full CI/CD automation. Complete documentation with visual guides included. Feedback collected for continuous improvement. GitHub infrastructure configured: tracking issue, workflows, release, and deployment."
}
```

### Example 2: Enhancement Mode (Bug Fix)

```json
{
  "session_id": "api-server-fix",
  "task_description": "Fix authentication bug in /api/login endpoint",
  "mode": "fix_bug",
  "status": "completed",
  "working_directory": "/Users/name/homelab/api-server",
  "started_at": "2025-10-24T14:00:00Z",
  "completed_at": "2025-10-24T14:25:15Z",
  "duration_minutes": 25.25,
  "phases_completed": [
    "Codebase Analysis",
    "Scout",
    "Architect",
    "Builder",
    "Test",
    "Deploy",
    "Feedback",
    "GitHub"
  ],
  "codebase_detection": {
    "has_existing_code": true,
    "project_type": "nodejs",
    "languages": ["javascript", "typescript"],
    "confidence": "high",
    "has_git": true,
    "git_clean": true
  },
  "test_results": {
    "tests_passed": true,
    "test_iterations": 2,
    "test_failures": [],
    "final_iteration": 2,
    "test_command": "npm test"
  },
  "files": {
    "files_created": [],
    "files_modified": [
      "src/routes/auth.js",
      "src/middleware/validate.js",
      "tests/auth.test.js"
    ],
    "total_files": 87
  },
  "git": {
    "initial_commit_sha": "def456abc789",
    "final_commit_sha": "ghi789def012",
    "branch": "fix/auth-validation",
    "remote_url": "https://github.com/snedea/api-server.git"
  },
  "screenshots": {
    "screenshots_captured": 0,
    "hero_screenshot": null,
    "manifest_path": null,
    "screenshot_types": []
  },
  "feedback": {
    "analyzed": true,
    "feedback_file": ".context-foundry/feedback/build-feedback-2025-10-24.json",
    "patterns_merged_to_global": true,
    "global_patterns_updated": [
      "~/.context-foundry/patterns/common-issues.json"
    ],
    "new_patterns_added_globally": 0,
    "existing_patterns_updated_globally": 1,
    "pattern_merge_status": "success",
    "pattern_merge_error": null,
    "high_priority_recommendations": 1,
    "cross_project_learning_enabled": true
  },
  "github": {
    "issue_number": 42,
    "issue_url": "https://github.com/snedea/api-server/issues/42",
    "issue_status": "closed",
    "pr_number": 43,
    "pr_url": "https://github.com/snedea/api-server/pull/43",
    "pr_status": "open",
    "release_version": null,
    "release_url": null,
    "pages_url": null,
    "pages_status": null,
    "workflows_created": false,
    "workflow_files": [],
    "actions_url": "https://github.com/snedea/api-server/actions",
    "branch_protection_enabled": false,
    "labels_created": [],
    "templates_created": []
  },
  "artifacts_location": ".context-foundry/",
  "issues_encountered": [],
  "success_summary": "Successfully fixed authentication bug. All tests passing after 2 iterations. Pull request created for review. GitHub tracking issue updated and closed."
}
```

### Example 3: Failed Build

```json
{
  "session_id": "complex-app",
  "task_description": "Build complex distributed system",
  "mode": "new_project",
  "status": "tests_failed_max_iterations",
  "working_directory": "/Users/name/homelab/complex-app",
  "started_at": "2025-10-24T16:00:00Z",
  "completed_at": "2025-10-24T17:30:00Z",
  "duration_minutes": 90,
  "phases_completed": [
    "Scout",
    "Architect",
    "Builder",
    "Test"
  ],
  "codebase_detection": null,
  "test_results": {
    "tests_passed": false,
    "test_iterations": 3,
    "test_failures": [
      "Integration test failed: Database connection timeout",
      "E2E test failed: Service mesh communication error"
    ],
    "final_iteration": 3,
    "test_command": "npm test"
  },
  "files": {
    "files_created": [
      "services/api/index.js",
      "services/worker/worker.js",
      "tests/integration.test.js"
    ],
    "files_modified": [],
    "total_files": 45
  },
  "git": {
    "initial_commit_sha": "aaa111bbb222",
    "final_commit_sha": "ccc333ddd444",
    "branch": "main",
    "remote_url": null
  },
  "screenshots": {
    "screenshots_captured": 0,
    "hero_screenshot": null,
    "manifest_path": null,
    "screenshot_types": []
  },
  "feedback": {
    "analyzed": true,
    "feedback_file": ".context-foundry/feedback/build-feedback-2025-10-24.json",
    "patterns_merged_to_global": true,
    "global_patterns_updated": [
      "~/.context-foundry/patterns/common-issues.json"
    ],
    "new_patterns_added_globally": 2,
    "existing_patterns_updated_globally": 0,
    "pattern_merge_status": "success",
    "pattern_merge_error": null,
    "high_priority_recommendations": 3,
    "cross_project_learning_enabled": true
  },
  "github": null,
  "artifacts_location": ".context-foundry/",
  "issues_encountered": [
    "Tests failed after 3 iterations",
    "Database connection issues in integration tests",
    "Service mesh configuration complexity"
  ],
  "success_summary": "Build failed after maximum test iterations. See .context-foundry/test-results-iteration-*.md for details. Feedback patterns collected for future builds."
}
```

## Migration from v1.0

If you have existing session summaries without the `github` field, they are still valid. The `github` field is optional and will only be populated for builds that complete Phase 7.5 (GitHub Integration).

### Backwards Compatibility

- All v1.0 fields are preserved in v2.0
- The `github` field is additive (doesn't break existing parsers)
- Builds that don't reach Phase 7.5 will have `github: null`

## Usage

### Reading Session Summary

```python
import json

with open('.context-foundry/session-summary.json', 'r') as f:
    summary = json.load(f)

# Check if build was successful
if summary['status'] == 'completed':
    print(f"✅ Build completed in {summary['duration_minutes']} minutes")

    # Check GitHub integration
    if summary.get('github'):
        print(f"📦 Release: {summary['github']['release_url']}")
        if summary['github']['pages_url']:
            print(f"🌐 Live demo: {summary['github']['pages_url']}")
else:
    print(f"❌ Build failed: {summary['status']}")
```

### Querying GitHub Metadata

```bash
# Get GitHub Pages URL
jq -r '.github.pages_url // "Not deployed"' .context-foundry/session-summary.json

# Get tracking issue
jq -r '.github.issue_url // "No issue"' .context-foundry/session-summary.json

# List workflows created
jq -r '.github.workflow_files[]' .context-foundry/session-summary.json
```

## See Also

- [GitHub Agent Documentation](GITHUB_AGENT_PROPOSAL.md)
- [Orchestrator Prompt](../tools/orchestrator_prompt.txt)
- [Session Summary Examples](../checkpoints/summaries/)

---

**Schema Version:** 2.1
**Last Updated:** 2025-10-24
**Maintainer:** Context Foundry Team

**Changelog:**
- v2.1: Added `prompt_metadata` for tracking prompt versions and performance
- v2.0: Added `github` object for GitHub integration tracking
- v1.0: Initial schema
